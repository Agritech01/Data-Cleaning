<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö Clean Data ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Prompt:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f72585;
            --info-color: #17a2b8;
            --border-radius: 12px;
            --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Prompt', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 40px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color), var(--danger-color));
        }
        
        h1 {
            font-family: 'Kanit', sans-serif;
            font-size: 2.8rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-weight: 600;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 25%;
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            max-width: 800px;
            margin: 20px auto 0;
            line-height: 1.8;
        }
        
        .version-badge {
            display: inline-block;
            background: linear-gradient(45deg, var(--danger-color), var(--primary-color));
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            font-family: 'Kanit', sans-serif;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 50px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .upload-section, .steps-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .upload-section::before, .steps-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
        }
        
        .section-title {
            font-size: 1.8rem;
            color: var(--secondary-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .section-title i {
            color: var(--accent-color);
        }
        
        .upload-area {
            border: 3px dashed var(--accent-color);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            background-color: rgba(76, 201, 240, 0.05);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .upload-area:hover {
            background-color: rgba(76, 201, 240, 0.1);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.2);
        }
        
        .upload-area i {
            font-size: 4rem;
            color: var(--accent-color);
            margin-bottom: 20px;
            transition: var(--transition);
        }
        
        .upload-area:hover i {
            transform: scale(1.1);
        }
        
        .upload-area h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .upload-area p {
            color: #666;
            margin-bottom: 5px;
        }
        
        .file-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: left;
            display: none;
            border-left: 4px solid var(--primary-color);
        }
        
        .file-info.show {
            display: block;
            animation: slideDown 0.5s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .file-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .file-info-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .file-info-label {
            font-weight: 600;
            color: var(--secondary-color);
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .file-info-value {
            color: var(--dark-color);
            font-family: 'Kanit', monospace;
            font-size: 1.1rem;
            word-break: break-all;
        }
        
        .file-input {
            display: none;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 30px;
            border: none;
            font-family: 'Kanit', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), #5a6de8);
            color: white;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #2a4be8, var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, var(--success-color), #5ec760);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .btn-success:hover {
            background: linear-gradient(45deg, #3d8b40, var(--success-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, var(--warning-color), #ffac33);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }
        
        .btn-warning:hover {
            background: linear-gradient(45deg, #cc7a00, var(--warning-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, var(--danger-color), #ff4da6);
            color: white;
            box-shadow: 0 4px 15px rgba(247, 37, 133, 0.3);
        }
        
        .btn-danger:hover {
            background: linear-gradient(45deg, #c21d6d, var(--danger-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(247, 37, 133, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(45deg, var(--info-color), #3dc5d9);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }
        
        .btn-info:hover {
            background: linear-gradient(45deg, #117a8b, var(--info-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 20px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-group .btn {
            flex: 1;
            min-width: 120px;
        }
        
        .btn-icon {
            padding: 10px;
            width: 40px;
            height: 40px;
            justify-content: center;
            border-radius: 50%;
        }
        
        .steps-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) #f1f1f1;
        }
        
        .steps-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .steps-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .steps-container::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 10px;
        }
        
        .step-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: var(--transition);
            border-left: 5px solid var(--primary-color);
        }
        
        .step-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .step-card.active {
            border-left-color: var(--success-color);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
        }
        
        .step-card.completed {
            border-left-color: #4caf50;
            opacity: 0.9;
        }
        
        .step-header {
            background-color: #f8f9fa;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .step-header:hover {
            background-color: #e9ecef;
        }
        
        .step-number {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
        }
        
        .step-card.completed .step-number {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
        }
        
        .step-card.active .step-number {
            background: linear-gradient(45deg, var(--success-color), #66bb6a);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        
        .step-title {
            font-size: 1.3rem;
            font-weight: 500;
            flex-grow: 1;
            color: var(--secondary-color);
        }
        
        .step-status {
            font-size: 0.85rem;
            padding: 6px 14px;
            border-radius: 20px;
            background-color: #e9ecef;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .step-card.completed .step-status {
            background-color: #d4edda;
            color: #155724;
        }
        
        .step-card.active .step-status {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .step-content {
            padding: 0 25px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        
        .step-card.active .step-content {
            padding: 25px;
            max-height: 1000px;
        }
        
        .step-subitems {
            list-style-type: none;
            margin-top: 15px;
        }
        
        .step-subitems li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            border-bottom: 1px dashed #eee;
            color: #555;
            transition: var(--transition);
        }
        
        .step-subitems li:hover {
            color: var(--secondary-color);
            transform: translateX(5px);
        }
        
        .step-subitems li:last-child {
            border-bottom: none;
        }
        
        .step-subitems li:before {
            content: "‚úì";
            color: var(--success-color);
            font-size: 1rem;
            font-weight: bold;
            position: absolute;
            left: 10px;
            top: 10px;
            transition: var(--transition);
        }
        
        .step-card.completed li:before {
            content: "‚úì";
            color: #4caf50;
        }
        
        .ai-feature {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.1) 0%, rgba(67, 97, 238, 0.05) 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-color);
            position: relative;
            overflow: hidden;
        }
        
        .ai-feature::before {
            content: 'AI';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-color);
            color: white;
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .ai-feature h4 {
            color: var(--accent-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        .ai-feature p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .data-preview {
            margin-top: 40px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            display: none;
            position: relative;
            overflow: hidden;
        }
        
        .data-preview.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .preview-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .data-table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 600px;
            overflow-y: auto;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 2000px;
            font-size: 0.9rem;
        }
        
        .data-table th {
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 10;
            min-width: 150px;
            border-right: 1px solid rgba(255,255,255,0.1);
            font-family: 'Kanit', sans-serif;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        .data-table th:last-child {
            border-right: none;
        }
        
        .data-table th i {
            margin-left: 5px;
            opacity: 0.8;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
            vertical-align: top;
            min-width: 150px;
            transition: background-color 0.2s;
            position: relative;
        }
        
        .data-table tr {
            transition: var(--transition);
        }
        
        .data-table tr:hover {
            background-color: #f8f9fa;
            transform: scale(1.001);
        }
        
        .data-table tr.error-row {
            background-color: #ffe6e6;
        }
        
        .data-table tr.error-row:hover {
            background-color: #ffd6d6;
        }
        
        .data-table tr.duplicate-row {
            background-color: #fff0f0;
        }
        
        .data-table tr.empty-row {
            background-color: #f0f8ff;
        }
        
        .data-table tr.selected-row {
            background-color: #e3f2fd;
        }
        
        .editable-cell {
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .editable-cell:hover {
            background-color: #e3f2fd;
            box-shadow: inset 0 0 0 2px rgba(67, 97, 238, 0.2);
        }
        
        .editable-cell.editing {
            background-color: #fffde7;
            padding: 0;
            box-shadow: inset 0 0 0 2px var(--accent-color);
        }
        
        .cell-input {
            width: 100%;
            height: 100%;
            border: 2px solid var(--accent-color);
            padding: 10px;
            font-size: 0.85rem;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: inherit;
            background: white;
            transition: var(--transition);
        }
        
        .cell-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.3);
            border-color: var(--primary-color);
        }
        
        .empty-cell {
            color: #ff9800;
            font-weight: bold;
            position: relative;
        }
        
        .empty-cell::before {
            content: '‚ö†';
            margin-right: 5px;
        }
        
        .duplicate-cell {
            color: #f72585;
            font-weight: bold;
            position: relative;
        }
        
        .duplicate-cell::before {
            content: 'üîÅ';
            margin-right: 5px;
        }
        
        .actions-section {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .dashboard-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-top: 40px;
            display: none;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-section.show {
            display: block;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        
        .chart {
            padding: 25px;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: var(--transition);
        }
        
        .chart:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        
        .chart-bar {
            height: 35px;
            background-color: #e9ecef;
            border-radius: 17.5px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chart-fill {
            height: 100%;
            border-radius: 17.5px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 20px;
            color: white;
            font-weight: 600;
            min-width: 60px;
            transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .chart-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
        }
        
        .chart-legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #ddd;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .legend-item:hover {
            background: rgba(0,0,0,0.05);
        }
        
        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .legend-text {
            font-size: 0.9rem;
            color: #555;
        }
        
        .legend-value {
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .limitations {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 6px solid #ffc107;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .limitations::before {
            content: '‚ö†';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3rem;
            opacity: 0.2;
            color: #856404;
        }
        
        .limitations h3 {
            color: #856404;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
        }
        
        .limitations ul {
            list-style-type: none;
        }
        
        .limitations li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            color: #856404;
        }
        
        .limitations li:before {
            content: '‚Ä¢';
            color: #ffc107;
            font-size: 1.5rem;
            position: absolute;
            left: 10px;
            top: 8px;
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            color: #666;
            margin-top: 50px;
            border-top: 1px solid #ddd;
            font-size: 0.9rem;
        }
        
        .loading-spinner {
            display: none;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            position: relative;
        }
        
        .loading-spinner::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 5px solid transparent;
            border-top: 5px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1.5s linear infinite reverse;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .loading-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .loading-content {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-width: 500px;
            width: 90%;
        }
        
        .loading-progress {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .column-selector {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            border-left: 4px solid var(--primary-color);
            animation: slideDown 0.3s ease;
        }
        
        .column-selector.show {
            display: block;
        }
        
        .column-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .column-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 20px;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .column-item:hover {
            background: #e9ecef;
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }
        
        .column-item.selected {
            background: #e3f2fd;
            border-color: var(--primary-color);
        }
        
        .column-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }
        
        .edit-controls {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            border-left: 4px solid var(--accent-color);
        }
        
        .edit-controls.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .edit-message {
            background: #d4edda;
            color: #155724;
            padding: 12px 20px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
            animation: slideDown 0.3s ease;
            border-left: 4px solid #28a745;
        }
        
        .edit-message.show {
            display: block;
        }
        
        .edit-message.error {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        
        .edit-message.warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }
        
        .edit-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left-color: #17a2b8;
        }
        
        .scroll-info {
            background: #e3f2fd;
            padding: 10px 20px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.9rem;
            display: none;
            border-left: 4px solid var(--accent-color);
            animation: slideDown 0.3s ease;
        }
        
        .scroll-info.show {
            display: block;
        }
        
        .toolbar {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
            padding: 5px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--dark-color) transparent transparent transparent;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .context-menu {
            position: fixed;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            min-width: 200px;
            overflow: hidden;
        }
        
        .context-menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .context-menu-item:hover {
            background: #f8f9fa;
        }
        
        .context-menu-item:last-child {
            border-bottom: none;
        }
        
        .context-menu-item.danger {
            color: var(--danger-color);
        }
        
        .context-menu-item.success {
            color: var(--success-color);
        }
        
        .search-box {
            position: relative;
            flex: 1;
            min-width: 200px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.3);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: white;
            color: var(--dark-color);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }
        
        .page-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .floating-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }
        
        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
            transition: var(--transition);
        }
        
        .floating-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.6);
        }
        
        .floating-btn.secondary {
            background: linear-gradient(45deg, var(--warning-color), #ffac33);
        }
        
        .floating-btn.danger {
            background: linear-gradient(45deg, var(--danger-color), #ff4da6);
        }
        
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .mode-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .mode-switch.active {
            background: var(--primary-color);
        }
        
        .mode-switch::before {
            content: 'üåô';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            transition: var(--transition);
        }
        
        .mode-switch.active::before {
            content: '‚òÄÔ∏è';
            left: calc(100% - 25px);
        }
        
        .mode-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .mode-switch.active::after {
            left: calc(100% - 27px);
        }
        
        .dark-mode {
            --light-color: #121212;
            --dark-color: #f8f9fa;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: var(--dark-color);
        }
        
        .dark-mode .upload-section,
        .dark-mode .steps-section,
        .dark-mode .data-preview,
        .dark-mode .dashboard-section,
        .dark-mode header {
            background-color: #2d2d2d;
            color: var(--dark-color);
        }
        
        .dark-mode .step-card {
            background: linear-gradient(135deg, #2d2d2d 0%, #3d3d3d 100%);
        }
        
        .dark-mode .data-table {
            background: #2d2d2d;
            color: var(--dark-color);
        }
        
        .dark-mode .data-table th {
            background: linear-gradient(to bottom, #3d3d3d, #4d4d4d);
        }
        
        .dark-mode .data-table tr:hover {
            background-color: #3d3d3d;
        }
        
        .responsive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 1.2rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-content {
            color: #666;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .section-title {
                font-size: 1.4rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .upload-section, .steps-section {
                padding: 20px;
            }
            
            .stats-bar {
                flex-direction: column;
                align-items: center;
            }
            
            .stat-item {
                min-width: 100%;
            }
            
            .toolbar {
                flex-direction: column;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group .btn {
                width: 100%;
            }
            
            .floating-buttons {
                bottom: 20px;
                right: 20px;
            }
            
            .floating-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .data-table {
                min-width: 3000px;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .chart {
                min-width: 100%;
            }
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .data-table-container {
                max-height: none;
                overflow: visible;
            }
        }
        
        .export-options {
            display: none;
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--box-shadow);
            animation: slideDown 0.3s ease;
        }
        
        .export-options.show {
            display: block;
        }
        
        .export-format {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .format-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .format-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
        }
        
        .format-option.selected {
            border-color: var(--primary-color);
            background: #f0f8ff;
        }
        
        .format-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
        }
        
        .format-name {
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .batch-edit-panel {
            display: none;
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 20px;
            box-shadow: var(--box-shadow);
            animation: slideDown 0.3s ease;
        }
        
        .batch-edit-panel.show {
            display: block;
        }
        
        .batch-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .form-control {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.3);
        }
        
        .auto-fix-panel {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 4px solid var(--success-color);
        }
        
        .highlight {
            background: yellow;
            color: black;
        }
        
        .cell-comment {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 8px;
            height: 8px;
            background: var(--warning-color);
            border-radius: 50%;
        }
        
        .comment-bubble {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            max-width: 300px;
            display: none;
        }
        
        .comment-bubble.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .comment-author {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .comment-text {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="dark-mode-toggle no-print">
        <div class="mode-switch" id="darkModeToggle"></div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 id="loadingTitle">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>
            <p id="loadingMessage">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgress"></div>
            </div>
            <div id="loadingDetails"></div>
        </div>
    </div>

    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-action="edit">
            <i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ã‡∏•‡∏•‡πå
        </div>
        <div class="context-menu-item" data-action="copy">
            <i class="fas fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
        </div>
        <div class="context-menu-item" data-action="delete">
            <i class="fas fa-trash"></i> ‡∏•‡∏ö‡∏Ñ‡πà‡∏≤
        </div>
        <div class="context-menu-item" data-action="fill-down">
            <i class="fas fa-arrow-down"></i> ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
        </div>
        <div class="context-menu-item" data-action="fill-up">
            <i class="fas fa-arrow-up"></i> ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
        </div>
        <div class="context-menu-item danger" data-action="delete-row">
            <i class="fas fa-trash-alt"></i> ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß
        </div>
        <div class="context-menu-item" data-action="insert-row">
            <i class="fas fa-plus"></i> ‡πÅ‡∏ó‡∏£‡∏Å‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà
        </div>
        <div class="context-menu-item" data-action="add-comment">
            <i class="fas fa-comment"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
        </div>
    </div>

    <div class="comment-bubble" id="commentBubble">
        <div class="comment-author" id="commentAuthor"></div>
        <div class="comment-text" id="commentText"></div>
    </div>

    <div class="container">
        <header>
            <h1><i class="fas fa-database"></i> ‡∏£‡∏∞‡∏ö‡∏ö Clean Data ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á <span class="version-badge">v3.0</span></h1>
            <p class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö Real-time</p>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="totalFiles">0</div>
                    <div class="stat-label">‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalRowsProcessed">0</div>
                    <div class="stat-label">‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalErrorsFixed">0</div>
                    <div class="stat-label">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="timeSaved">0</div>
                    <div class="stat-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î (‡∏ä‡∏°.)</div>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="upload-section">
                <h2 class="section-title"><i class="fas fa-file-upload"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV</h2>
                
                <div class="toolbar">
                    <div class="toolbar-group">
                        <button class="btn btn-sm btn-primary" id="browseBtn">
                            <i class="fas fa-folder-open"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                        </button>
                        <input type="file" id="csvFileInput" class="file-input" accept=".csv,.xlsx,.xls,.json,.txt">
                    </div>
                    
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    
                    <div class="toolbar-group">
                        <button class="btn btn-sm btn-info tooltip" id="importBtn" title="‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô">
                            <i class="fas fa-file-import"></i>
                        </button>
                        <button class="btn btn-sm btn-success tooltip" id="sampleDataBtn" title="‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á">
                            <i class="fas fa-vial"></i>
                        </button>
                        <button class="btn btn-sm btn-warning tooltip" id="scanBtn" title="‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏õ‡∏±‡∏ç‡∏´‡∏≤">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-file-csv"></i>
                    <h3>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h3>
                    <p>‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
                    <p><strong>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå CSV, Excel, JSON ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ñ‡∏∂‡∏á 500MB</strong></p>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="uploadBtn">
                            <i class="fas fa-cloud-upload-alt"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
                        </button>
                        <button class="btn btn-info" id="googleDriveBtn">
                            <i class="fab fa-google-drive"></i> Google Drive
                        </button>
                        <button class="btn btn-success" id="dropboxBtn">
                            <i class="fab fa-dropbox"></i> Dropbox
                        </button>
                    </div>
                </div>
                
                <div class="file-info" id="fileInfo">
                    <h4><i class="fas fa-info-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå</h4>
                    <div class="file-info-grid">
                        <div class="file-info-item">
                            <span class="file-info-label">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</span>
                            <span class="file-info-value" id="fileName">-</span>
                        </div>
                        <div class="file-info-item">
                            <span class="file-info-label">‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå:</span>
                            <span class="file-info-value" id="fileSize">-</span>
                        </div>
                        <div class="file-info-item">
                            <span class="file-info-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß:</span>
                            <span class="file-info-value" id="fileRows">-</span>
                        </div>
                        <div class="file-info-item">
                            <span class="file-info-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå:</span>
                            <span class="file-info-value" id="fileCols">-</span>
                        </div>
                        <div class="file-info-item">
                            <span class="file-info-label">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå:</span>
                            <span class="file-info-value" id="fileType">-</span>
                        </div>
                        <div class="file-info-item">
                            <span class="file-info-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</span>
                            <span class="file-info-value" id="fileTime">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="actions-section">
                    <div class="btn-group">
                        <button class="btn btn-success" id="processBtn" disabled>
                            <i class="fas fa-cogs"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI
                        </button>
                        <button class="btn btn-primary" id="autoFixBtn" disabled>
                            <i class="fas fa-robot"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        </button>
                        <button class="btn btn-warning" id="validateBtn" disabled>
                            <i class="fas fa-check-circle"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                        </button>
                        <button class="btn btn-danger" id="resetBtn">
                            <i class="fas fa-redo"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                </div>
                
                <div class="auto-fix-panel" id="autoFixPanel" style="display: none;">
                    <h4><i class="fas fa-magic"></i> ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h4>
                    <div id="autoFixResults"></div>
                </div>
            </div>
            
            <div class="steps-section">
                <h2 class="section-title"><i class="fas fa-list-ol"></i> ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Clean Data</h2>
                
                <div class="steps-container" id="stepsContainer">
                    <!-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </div>
                
                <div class="batch-edit-panel" id="batchEditPanel">
                    <h4><i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∏‡∏î</h4>
                    <div class="batch-form">
                        <div class="form-group">
                            <label class="form-label">‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå:</label>
                            <select class="form-control" id="batchColumn">
                                <!-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥:</label>
                            <select class="form-control" id="batchAction">
                                <option value="replace">‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤</option>
                                <option value="uppercase">‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà</option>
                                <option value="lowercase">‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å</option>
                                <option value="trim">‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</option>
                                <option value="fill_empty">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á</option>
                                <option value="remove_duplicates">‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥</option>
                            </select>
                        </div>
                        <div class="form-group" id="batchValueGroup">
                            <label class="form-label">‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà:</label>
                            <input type="text" class="form-control" id="batchValue" placeholder="‡∏õ‡πâ‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£">
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" id="applyBatchBtn">
                            <i class="fas fa-check"></i> ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ
                        </button>
                        <button class="btn btn-warning" id="previewBatchBtn">
                            <i class="fas fa-eye"></i> ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                        </button>
                        <button class="btn btn-danger" id="cancelBatchBtn">
                            <i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="data-preview" id="dataPreview">
            <div class="preview-title">
                <h2 class="section-title"><i class="fas fa-table"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span id="rowCount">0 ‡πÅ‡∏ñ‡∏ß</span> | 
                    <span id="colCount">0 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå</span>
                    <span id="selectedCount" style="display: none; background: var(--primary-color); color: white; padding: 2px 8px; border-radius: 10px;"></span>
                </div>
            </div>
            
            <div class="toolbar">
                <div class="toolbar-group">
                    <button class="btn btn-sm btn-primary" id="toggleColumnSelector">
                        <i class="fas fa-columns"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
                    </button>
                    <button class="btn btn-sm btn-warning" id="toggleEditMode">
                        <i class="fas fa-edit"></i> ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                    <button class="btn btn-sm btn-success" id="saveAllBtn">
                        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button class="btn btn-sm btn-danger" id="cancelEditBtn">
                        <i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
                
                <div class="toolbar-group">
                    <button class="btn btn-sm btn-info" id="exportBtn">
                        <i class="fas fa-download"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
                    </button>
                    <button class="btn btn-sm btn-warning" id="printBtn">
                        <i class="fas fa-print"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå
                    </button>
                    <button class="btn btn-sm btn-success" id="shareBtn">
                        <i class="fas fa-share"></i> ‡πÅ‡∏ä‡∏£‡πå
                    </button>
                </div>
                
                <div class="toolbar-group">
                    <button class="btn btn-sm btn-primary" id="undoBtn" disabled>
                        <i class="fas fa-undo"></i> ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button class="btn btn-sm btn-primary" id="redoBtn" disabled>
                        <i class="fas fa-redo"></i> ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥
                    </button>
                </div>
            </div>
            
            <div class="scroll-info" id="scrollInfo">
                <i class="fas fa-info-circle"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </div>
            
            <div class="column-selector" id="columnSelector">
                <h4><i class="fas fa-columns"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á</h4>
                <div class="column-list" id="columnList">
                    <!-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </div>
                <div class="btn-group" style="margin-top: 15px;">
                    <button class="btn btn-sm btn-primary" id="selectAllColumns">
                        <i class="fas fa-check-square"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                    <button class="btn btn-sm btn-warning" id="deselectAllColumns">
                        <i class="fas fa-times-circle"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                    <button class="btn btn-sm btn-success" id="applyColumnSelection">
                        <i class="fas fa-check"></i> ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ
                    </button>
                </div>
            </div>
            
            <div class="edit-controls" id="editControls">
                <h4><i class="fas fa-edit"></i> ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                <p>‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÉ‡∏î‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ Esc ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</p>
                <div class="edit-message" id="editMessage"></div>
            </div>
            
            <div class="data-table-container">
                <table class="data-table" id="dataTable">
                    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </table>
            </div>
            
            <div class="pagination" id="pagination">
                <!-- Pagination ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
            </div>
        </div>
        
        <div class="export-options" id="exportOptions">
            <h4><i class="fas fa-download"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</h4>
            <div class="export-format">
                <div class="format-option" data-format="csv">
                    <i class="fas fa-file-csv format-icon"></i>
                    <span class="format-name">CSV</span>
                    <small>‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</small>
                </div>
                <div class="format-option" data-format="excel">
                    <i class="fas fa-file-excel format-icon"></i>
                    <span class="format-name">Excel</span>
                    <small>Microsoft Excel</small>
                </div>
                <div class="format-option" data-format="json">
                    <i class="fas fa-file-code format-icon"></i>
                    <span class="format-name">JSON</span>
                    <small>‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</small>
                </div>
                <div class="format-option" data-format="pdf">
                    <i class="fas fa-file-pdf format-icon"></i>
                    <span class="format-name">PDF</span>
                    <small>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ PDF</small>
                </div>
                <div class="format-option" data-format="sql">
                    <i class="fas fa-database format-icon"></i>
                    <span class="format-name">SQL</span>
                    <small>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</small>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-success" id="confirmExportBtn">
                    <i class="fas fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                </button>
                <button class="btn btn-danger" id="cancelExportBtn">
                    <i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>
        
        <div class="dashboard-section" id="dashboardSection">
            <h2 class="section-title"><i class="fas fa-chart-pie"></i> Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h2>
            
            <div class="charts-container">
                <div class="chart">
                    <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Error Categorization</h3>
                    <div class="chart-bar">
                        <div class="chart-fill" id="duplicateBar" style="width: 0%; background: linear-gradient(90deg, #f72585, #ff4da6);">0%</div>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-fill" id="emptyBar" style="width: 0%; background: linear-gradient(90deg, #4361ee, #5a6de8);">0%</div>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-fill" id="formatBar" style="width: 0%; background: linear-gradient(90deg, #4cc9f0, #6fd8f5);">0%</div>
                    </div>
                    
                    <div class="chart-legend">
                        <div class="legend-item" data-category="duplicate">
                            <div class="legend-color" style="background: #f72585;"></div>
                            <span class="legend-text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥</span>
                            <span class="legend-value" id="duplicateValue">0%</span>
                        </div>
                        <div class="legend-item" data-category="empty">
                            <div class="legend-color" style="background: #4361ee;"></div>
                            <span class="legend-text">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á</span>
                            <span class="legend-value" id="emptyValue">0%</span>
                        </div>
                        <div class="legend-item" data-category="format">
                            <div class="legend-color" style="background: #4cc9f0;"></div>
                            <span class="legend-text">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏¥‡∏î</span>
                            <span class="legend-value" id="formatValue">0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="chart">
                    <h3 class="chart-title"><i class="fas fa-chart-pie"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <div style="text-align: center; padding: 20px;">
                        <div style="width: 200px; height: 200px; border-radius: 50%; background: conic-gradient(#4caf50 0%, #ff9800 0%); margin: 0 auto; position: relative; display: flex; align-items: center; justify-content: center;" id="statusCircle">
                            <div style="width: 150px; height: 150px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                                <span style="font-size: 2rem; font-weight: bold; color: var(--dark-color);" id="correctPercent">0%</span>
                                <span style="color: #666;">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <p><span style="color: #4caf50; font-weight: bold;" id="correctCount">0% ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</p>
                            <p><span style="color: #ff9800; font-weight: bold;" id="errorCount">0% ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span> ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</p>
                        </div>
                    </div>
                </div>
                
                <div class="chart">
                    <h3 class="chart-title"><i class="fas fa-chart-line"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</h3>
                    <div id="typeChart" style="height: 200px; margin: 20px 0;"></div>
                    <div class="chart-legend" id="typeLegend">
                        <!-- Legend ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="actions-section">
                <button class="btn btn-success" id="downloadBtn" disabled>
                    <i class="fas fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà Clean ‡πÅ‡∏•‡πâ‡∏ß
                </button>
                <button class="btn btn-warning" id="generateReportBtn">
                    <i class="fas fa-file-alt"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                </button>
                <button class="btn btn-info" id="exportDashboardBtn">
                    <i class="fas fa-chart-bar"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Dashboard
                </button>
            </div>
        </div>
        
        <div class="limitations">
            <h3><i class="fas fa-exclamation-triangle"></i> ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <ul>
                <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ñ‡∏∂‡∏á 500MB ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ Web Workers</li>
                <li>‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô AI ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö AI Service ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ</li>
                <li>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Offline ‡∏ú‡πà‡∏≤‡∏ô Service Worker</li>
                <li>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° Back-end ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö Authentication ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô</li>
                <li>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Real-time Collaboration</li>
                <li>‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Undo/Redo ‡πÅ‡∏•‡∏∞ History ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
            </ul>
        </div>
        
        <footer>
            <p>¬© 2024 ‡∏£‡∏∞‡∏ö‡∏ö Clean Data ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ</p>
            <p style="font-size: 0.8rem; margin-top: 10px;">
                <span id="appVersion">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô 3.0.0</span> | 
                <span id="lastUpdate">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: 2024-01-16</span> | 
                <span id="dataStatus">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
            </p>
        </footer>
    </div>

    <div class="floating-buttons no-print">
        <button class="floating-btn" id="floatingHelp" title="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠">
            <i class="fas fa-question"></i>
        </button>
        <button class="floating-btn secondary" id="floatingQuickFix" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏î‡πà‡∏ß‡∏ô" style="display: none;">
            <i class="fas fa-bolt"></i>
            <span class="notification-badge" id="quickFixCount">0</span>
        </button>
        <button class="floating-btn danger" id="floatingBackup" title="‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
            <i class="fas fa-save"></i>
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ toastr
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": true,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        const stepsData = [
            {
                number: 1,
                title: "‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ",
                items: ["‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå", "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ß‡∏±‡∏î", "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", "‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"],
                aiFeature: false
            },
            {
                number: 2,
                title: "‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö clean data",
                items: ["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå CSV, Excel, JSON", "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå", "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå", "‡∏≠‡πà‡∏≤‡∏ô Metadata"],
                aiFeature: false
            },
            {
                number: 3,
                title: "AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç",
                items: [
                    "‡∏ï‡∏£‡∏ß‡∏à‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥",
                    "‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á",
                    "‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏£‡∏á‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡∏ô‡∏±‡πâ‡∏ô",
                    "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)",
                    "‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (Outliers)"
                ],
                aiFeature: true
            },
            {
                number: 4,
                title: "AI ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏î‡πâ",
                items: [
                    "‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô",
                    "‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà 'Accept/Reject' ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏±‡πâ‡∏ô‡πÜ",
                    "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
                    "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
                ],
                aiFeature: true
            },
            {
                number: 5,
                title: "AI ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î",
                items: ["‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô dashboard", "‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°"],
                aiFeature: true
            },
            {
                number: 6,
                title: "Error Categorization",
                items: [
                    "‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö",
                    "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÑ‡∏î‡πâ",
                    "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç",
                    "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á"
                ],
                aiFeature: true
            }
        ];

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å
        class DataCleaningSystem {
            constructor() {
                this.uploadedData = null;
                this.processedData = null;
                this.allDataRows = [];
                this.displayedColumns = [];
                this.displayedRows = [];
                this.currentPage = 1;
                this.rowsPerPage = 100;
                this.isEditMode = false;
                this.editHistory = [];
                this.currentHistoryIndex = -1;
                this.editedCells = new Map();
                this.selectedCells = new Set();
                this.comments = new Map();
                this.validationRules = [];
                this.autoFixSuggestions = [];
                this.stats = {
                    totalFiles: 0,
                    totalRowsProcessed: 0,
                    totalErrorsFixed: 0,
                    timeSaved: 0
                };
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.createSteps();
                this.loadStats();
                this.setupServiceWorker();
                this.setupKeyboardShortcuts();
                this.updateUI();
            }
            
            setupEventListeners() {
                // File upload events
                document.getElementById('browseBtn').addEventListener('click', () => {
                    document.getElementById('csvFileInput').click();
                });
                
                document.getElementById('uploadBtn').addEventListener('click', () => {
                    document.getElementById('csvFileInput').click();
                });
                
                document.getElementById('csvFileInput').addEventListener('change', (e) => {
                    this.handleFileUpload(e.target.files[0]);
                });
                
                // Drag and drop
                const uploadArea = document.getElementById('uploadArea');
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = 'var(--primary-color)';
                    uploadArea.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.style.borderColor = 'var(--accent-color)';
                    uploadArea.style.backgroundColor = 'rgba(76, 201, 240, 0.05)';
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = 'var(--accent-color)';
                    uploadArea.style.backgroundColor = 'rgba(76, 201, 240, 0.05)';
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFileUpload(files[0]);
                    }
                });
                
                // Process buttons
                document.getElementById('processBtn').addEventListener('click', () => this.processData());
                document.getElementById('autoFixBtn').addEventListener('click', () => this.autoFix());
                document.getElementById('validateBtn').addEventListener('click', () => this.validateData());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetAll());
                
                // Edit mode controls
                document.getElementById('toggleEditMode').addEventListener('click', () => this.toggleEditMode());
                document.getElementById('saveAllBtn').addEventListener('click', () => this.saveAllEdits());
                document.getElementById('cancelEditBtn').addEventListener('click', () => this.cancelAllEdits());
                
                // Column selector
                document.getElementById('toggleColumnSelector').addEventListener('click', () => {
                    document.getElementById('columnSelector').classList.toggle('show');
                });
                
                document.getElementById('selectAllColumns').addEventListener('click', () => {
                    document.querySelectorAll('.column-checkbox').forEach(cb => cb.checked = true);
                });
                
                document.getElementById('deselectAllColumns').addEventListener('click', () => {
                    document.querySelectorAll('.column-checkbox').forEach(cb => cb.checked = false);
                });
                
                document.getElementById('applyColumnSelection').addEventListener('click', () => this.applyColumnSelection());
                
                // Export controls
                document.getElementById('exportBtn').addEventListener('click', () => {
                    document.getElementById('exportOptions').classList.toggle('show');
                });
                
                document.getElementById('confirmExportBtn').addEventListener('click', () => this.exportData());
                document.getElementById('cancelExportBtn').addEventListener('click', () => {
                    document.getElementById('exportOptions').classList.remove('show');
                });
                
                // Undo/Redo
                document.getElementById('undoBtn').addEventListener('click', () => this.undo());
                document.getElementById('redoBtn').addEventListener('click', () => this.redo());
                
                // Floating buttons
                document.getElementById('floatingHelp').addEventListener('click', () => this.showHelp());
                document.getElementById('floatingQuickFix').addEventListener('click', () => this.applyQuickFixes());
                document.getElementById('floatingBackup').addEventListener('click', () => this.createBackup());
                
                // Dark mode toggle
                document.getElementById('darkModeToggle').addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    document.getElementById('darkModeToggle').classList.toggle('active');
                    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
                });
                
                // Search functionality
                document.getElementById('searchInput').addEventListener('input', (e) => this.searchData(e.target.value));
                
                // Context menu
                document.addEventListener('contextmenu', (e) => this.showContextMenu(e));
                document.addEventListener('click', () => this.hideContextMenu());
                
                // Sample data
                document.getElementById('sampleDataBtn').addEventListener('click', () => this.loadSampleData());
                
                // Print
                document.getElementById('printBtn').addEventListener('click', () => window.print());
                
                // Initialize dark mode
                if (localStorage.getItem('darkMode') === 'true') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('darkModeToggle').classList.add('active');
                }
            }
            
            createSteps() {
                const stepsContainer = document.getElementById('stepsContainer');
                stepsContainer.innerHTML = '';
                
                stepsData.forEach(step => {
                    const stepCard = document.createElement('div');
                    stepCard.className = 'step-card';
                    stepCard.id = `step-${step.number}`;
                    
                    stepCard.innerHTML = `
                        <div class="step-header" data-step="${step.number}">
                            <div class="step-number">${step.number}</div>
                            <h3 class="step-title">${step.title}</h3>
                            <div class="step-status">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
                        </div>
                        <div class="step-content">
                            <ul class="step-subitems">
                                ${step.items.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                            ${step.aiFeature ? `
                            <div class="ai-feature">
                                <h4><i class="fas fa-robot"></i> ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ AI</h4>
                                <p>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</p>
                            </div>
                            ` : ''}
                        </div>
                    `;
                    
                    stepsContainer.appendChild(stepCard);
                    
                    // Add click event for step headers
                    stepCard.querySelector('.step-header').addEventListener('click', () => {
                        const isActive = stepCard.classList.contains('active');
                        document.querySelectorAll('.step-card').forEach(c => c.classList.remove('active'));
                        if (!isActive) stepCard.classList.add('active');
                    });
                });
                
                // Open first step by default
                document.getElementById('step-1').classList.add('active');
            }
            
            async handleFileUpload(file) {
                if (!file) return;
                
                try {
                    this.showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå...');
                    
                    // Validate file
                    if (!this.validateFile(file)) {
                        toastr.error('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ');
                        return;
                    }
                    
                    // Read file based on type
                    const data = await this.readFile(file);
                    this.uploadedData = data;
                    
                    // Update file info
                    this.updateFileInfo(file, data);
                    
                    // Create column selector
                    this.createColumnSelector(data.headers);
                    
                    // Display first page
                    this.displayDataPage(1);
                    
                    // Enable process buttons
                    document.getElementById('processBtn').disabled = false;
                    document.getElementById('autoFixBtn').disabled = false;
                    document.getElementById('validateBtn').disabled = false;
                    
                    // Update stats
                    this.stats.totalFiles++;
                    this.stats.totalRowsProcessed += data.totalRows;
                    this.updateStats();
                    
                    // Save to IndexedDB
                    await this.saveToIndexedDB(data);
                    
                    toastr.success(`‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå "${file.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                    
                } catch (error) {
                    console.error('Error loading file:', error);
                    toastr.error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
                } finally {
                    this.hideLoading();
                }
            }
            
            validateFile(file) {
                const maxSize = 500 * 1024 * 1024; // 500MB
                const allowedTypes = [
                    'text/csv',
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/json',
                    'text/plain'
                ];
                
                if (file.size > maxSize) {
                    toastr.error('‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 500MB');
                    return false;
                }
                
                if (!allowedTypes.includes(file.type) && 
                    !file.name.match(/\.(csv|xlsx|xls|json|txt)$/i)) {
                    toastr.error('‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå CSV, Excel, JSON, TXT');
                    return false;
                }
                
                return true;
            }
            
            async readFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const content = e.target.result;
                            let data;
                            
                            if (file.name.endsWith('.csv') || file.type === 'text/csv') {
                                data = this.parseCSV(content);
                            } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                                data = this.parseExcel(content);
                            } else if (file.name.endsWith('.json') || file.type === 'application/json') {
                                data = this.parseJSON(content);
                            } else {
                                data = this.parseText(content);
                            }
                            
                            resolve(data);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = () => reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ'));
                    
                    if (file.type.includes('text') || file.type === 'application/json') {
                        reader.readAsText(file, 'UTF-8');
                    } else {
                        reader.readAsArrayBuffer(file);
                    }
                });
            }
            
            parseCSV(content) {
                const lines = content.split('\n').filter(line => line.trim() !== '');
                if (lines.length === 0) throw new Error('‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
                
                const headers = this.parseCSVLine(lines[0]);
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = this.parseCSVLine(lines[i]);
                    const row = {};
                    
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    
                    row._rowNumber = i;
                    data.push(row);
                }
                
                return {
                    headers,
                    data,
                    totalRows: data.length,
                    fileType: 'CSV'
                };
            }
            
            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        if (i === 0 || line[i-1] !== '\\') {
                            inQuotes = !inQuotes;
                        } else {
                            current += char;
                        }
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result.map(val => val.replace(/^"|"$/g, ''));
            }
            
            parseExcel(buffer) {
                const workbook = XLSX.read(buffer, { type: 'array' });
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                if (data.length === 0) throw new Error('‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
                
                const headers = data[0];
                const rows = [];
                
                for (let i = 1; i < data.length; i++) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = data[i][index] || '';
                    });
                    row._rowNumber = i;
                    rows.push(row);
                }
                
                return {
                    headers,
                    data: rows,
                    totalRows: rows.length,
                    fileType: 'Excel'
                };
            }
            
            parseJSON(content) {
                const jsonData = JSON.parse(content);
                let headers, data;
                
                if (Array.isArray(jsonData)) {
                    if (jsonData.length === 0) throw new Error('‡πÑ‡∏ü‡∏•‡πå JSON ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
                    headers = Object.keys(jsonData[0]);
                    data = jsonData.map((item, index) => ({
                        ...item,
                        _rowNumber: index
                    }));
                } else {
                    // Assume it's an object with data array
                    headers = jsonData.headers || Object.keys(jsonData.data?.[0] || {});
                    data = (jsonData.data || []).map((item, index) => ({
                        ...item,
                        _rowNumber: index
                    }));
                }
                
                return {
                    headers,
                    data,
                    totalRows: data.length,
                    fileType: 'JSON'
                };
            }
            
            parseText(content) {
                const lines = content.split('\n').filter(line => line.trim() !== '');
                if (lines.length === 0) throw new Error('‡πÑ‡∏ü‡∏•‡πå‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
                
                // Try to detect delimiter
                const firstLine = lines[0];
                const delimiters = [',', '\t', ';', '|'];
                let delimiter = ',';
                let maxCount = 0;
                
                delimiters.forEach(delim => {
                    const count = firstLine.split(delim).length;
                    if (count > maxCount) {
                        maxCount = count;
                        delimiter = delim;
                    }
                });
                
                const headers = firstLine.split(delimiter).map(h => h.trim());
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(delimiter).map(v => v.trim());
                    const row = {};
                    
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    
                    row._rowNumber = i;
                    data.push(row);
                }
                
                return {
                    headers,
                    data,
                    totalRows: data.length,
                    fileType: 'TXT'
                };
            }
            
            updateFileInfo(file, data) {
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = this.formatFileSize(file.size);
                document.getElementById('fileRows').textContent = data.totalRows.toLocaleString();
                document.getElementById('fileCols').textContent = data.headers.length;
                document.getElementById('fileType').textContent = data.fileType;
                document.getElementById('fileTime').textContent = new Date().toLocaleString('th-TH');
                
                document.getElementById('fileInfo').classList.add('show');
                document.getElementById('dataPreview').classList.add('show');
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            createColumnSelector(headers) {
                const columnList = document.getElementById('columnList');
                const batchColumnSelect = document.getElementById('batchColumn');
                
                columnList.innerHTML = '';
                batchColumnSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå</option>';
                
                headers.forEach((header, index) => {
                    // Column list checkboxes
                    const columnItem = document.createElement('div');
                    columnItem.className = 'column-item';
                    
                    const checkboxId = `col-${index}`;
                    columnItem.innerHTML = `
                        <input type="checkbox" class="column-checkbox" id="${checkboxId}" checked>
                        <label for="${checkboxId}">${header}</label>
                    `;
                    
                    columnList.appendChild(columnItem);
                    
                    // Batch edit dropdown
                    const option = document.createElement('option');
                    option.value = header;
                    option.textContent = header;
                    batchColumnSelect.appendChild(option);
                });
                
                // Initialize with first 20 columns
                this.displayedColumns = headers.slice(0, 20);
            }
            
            applyColumnSelection() {
                const selectedColumns = [];
                document.querySelectorAll('.column-checkbox:checked').forEach((checkbox, index) => {
                    selectedColumns.push(this.uploadedData.headers[index]);
                });
                
                if (selectedColumns.length === 0) {
                    toastr.warning('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå');
                    return;
                }
                
                this.displayedColumns = selectedColumns;
                this.displayDataPage(this.currentPage);
                
                document.getElementById('columnSelector').classList.remove('show');
                toastr.success(`‡πÅ‡∏™‡∏î‡∏á ${selectedColumns.length} ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå`);
            }
            
            displayDataPage(page) {
                if (!this.uploadedData) return;
                
                this.currentPage = page;
                const start = (page - 1) * this.rowsPerPage;
                const end = start + this.rowsPerPage;
                this.displayedRows = this.uploadedData.data.slice(start, end);
                
                this.renderTable(this.displayedRows);
                this.createPagination();
                
                // Update counts
                document.getElementById('rowCount').textContent = 
                    `${this.uploadedData.totalRows.toLocaleString()} ‡πÅ‡∏ñ‡∏ß (‡πÅ‡∏™‡∏î‡∏á ${start + 1}-${Math.min(end, this.uploadedData.totalRows)})`;
                document.getElementById('colCount').textContent = 
                    `${this.displayedColumns.length} ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${this.uploadedData.headers.length})`;
                
                // Show scroll info if many columns
                if (this.displayedColumns.length > 10) {
                    document.getElementById('scrollInfo').classList.add('show');
                }
            }
            
            renderTable(rows) {
                const table = document.getElementById('dataTable');
                table.innerHTML = '';
                
                // Create header
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                
                this.displayedColumns.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    th.title = header;
                    th.addEventListener('click', () => this.sortColumn(header));
                    headerRow.appendChild(th);
                });
                
                // Add status column if processed
                if (this.processedData) {
                    const statusTh = document.createElement('th');
                    statusTh.textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
                    headerRow.appendChild(statusTh);
                }
                
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // Create body
                const tbody = document.createElement('tbody');
                
                rows.forEach((row, rowIndex) => {
                    const tr = document.createElement('tr');
                    tr.dataset.rowIndex = start + rowIndex;
                    
                    let hasIssue = false;
                    let issueType = '';
                    
                    this.displayedColumns.forEach(header => {
                        const td = document.createElement('td');
                        td.className = 'editable-cell';
                        td.dataset.row = start + rowIndex;
                        td.dataset.column = header;
                        td.dataset.originalValue = row[header] || '';
                        
                        const value = row[header] || '';
                        td.textContent = value;
                        td.title = value;
                        
                        // Check for issues
                        if (this.processedData) {
                            const issues = this.processedData.issues;
                            if (issues && issues[row._rowNumber] && issues[row._rowNumber][header]) {
                                const issue = issues[row._rowNumber][header];
                                td.classList.add(`${issue.type}-cell`);
                                td.title = issue.message;
                                hasIssue = true;
                                issueType = issue.type;
                            }
                        }
                        
                        // Add double click for editing
                        td.addEventListener('dblclick', (e) => this.startCellEdit(e.target));
                        
                        // Add right click for context menu
                        td.addEventListener('contextmenu', (e) => {
                            e.preventDefault();
                            this.selectedCells.clear();
                            this.selectedCells.add(td);
                            this.showContextMenu(e, td);
                        });
                        
                        // Add click for selection
                        td.addEventListener('click', (e) => {
                            if (e.shiftKey) {
                                this.selectedCells.add(td);
                                td.classList.add('selected');
                            } else if (e.ctrlKey || e.metaKey) {
                                if (this.selectedCells.has(td)) {
                                    this.selectedCells.delete(td);
                                    td.classList.remove('selected');
                                } else {
                                    this.selectedCells.add(td);
                                    td.classList.add('selected');
                                }
                            } else {
                                this.selectedCells.forEach(cell => cell.classList.remove('selected'));
                                this.selectedCells.clear();
                                this.selectedCells.add(td);
                                td.classList.add('selected');
                            }
                            
                            this.updateSelectedCount();
                        });
                        
                        tr.appendChild(td);
                    });
                    
                    // Add status column if processed
                    if (this.processedData) {
                        const statusTd = document.createElement('td');
                        if (hasIssue) {
                            statusTd.innerHTML = `<span style="color: #ff9800;"><i class="fas fa-exclamation-circle"></i> ${issueType}</span>`;
                            tr.classList.add('error-row');
                        } else {
                            statusTd.innerHTML = '<span style="color: #4caf50;"><i class="fas fa-check-circle"></i> ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>';
                        }
                        tr.appendChild(statusTd);
                    }
                    
                    tbody.appendChild(tr);
                });
                
                table.appendChild(tbody);
                
                // Update pagination
                this.createPagination();
            }
            
            createPagination() {
                if (!this.uploadedData) return;
                
                const totalPages = Math.ceil(this.uploadedData.totalRows / this.rowsPerPage);
                const pagination = document.getElementById('pagination');
                pagination.innerHTML = '';
                
                // Previous button
                const prevBtn = document.createElement('button');
                prevBtn.className = 'page-btn';
                prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevBtn.disabled = this.currentPage === 1;
                prevBtn.addEventListener('click', () => this.displayDataPage(this.currentPage - 1));
                pagination.appendChild(prevBtn);
                
                // Page numbers
                const startPage = Math.max(1, this.currentPage - 2);
                const endPage = Math.min(totalPages, this.currentPage + 2);
                
                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `page-btn ${i === this.currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', () => this.displayDataPage(i));
                    pagination.appendChild(pageBtn);
                }
                
                // Next button
                const nextBtn = document.createElement('button');
                nextBtn.className = 'page-btn';
                nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextBtn.disabled = this.currentPage === totalPages;
                nextBtn.addEventListener('click', () => this.displayDataPage(this.currentPage + 1));
                pagination.appendChild(nextBtn);
                
                // Page info
                const pageInfo = document.createElement('span');
                pageInfo.textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${this.currentPage} ‡∏à‡∏≤‡∏Å ${totalPages}`;
                pageInfo.style.marginLeft = '10px';
                pageInfo.style.color = '#666';
                pagination.appendChild(pageInfo);
            }
            
            async processData() {
                if (!this.uploadedData) return;
                
                try {
                    this.showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI...', 0);
                    
                    // Step 1: Define conditions
                    await this.updateStep(1, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç...');
                    await this.simulateProgress(10);
                    
                    // Step 2: Load file
                    await this.updateStep(2, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå...');
                    await this.simulateProgress(20);
                    
                    // Step 3: AI validation
                    await this.updateStep(3, 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                    this.processedData = await this.analyzeDataWithAI(this.uploadedData);
                    await this.simulateProgress(50);
                    
                    // Step 4: AI suggestions
                    await this.updateStep(4, 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...');
                    this.generateAutoFixSuggestions();
                    await this.simulateProgress(70);
                    
                    // Step 5: Summary
                    await this.updateStep(5, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•...');
                    this.displayDataPage(1);
                    await this.simulateProgress(90);
                    
                    // Step 6: Error categorization
                    await this.updateStep(6, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î...');
                    this.updateDashboard();
                    await this.simulateProgress(100);
                    
                    // Enable download
                    document.getElementById('downloadBtn').disabled = false;
                    document.getElementById('floatingQuickFix').style.display = 'flex';
                    
                    // Show results
                    this.showAnalysisResults();
                    
                    toastr.success('‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    
                } catch (error) {
                    console.error('Error processing data:', error);
                    toastr.error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
                } finally {
                    this.hideLoading();
                }
            }
            
            async analyzeDataWithAI(data) {
                // This is a simulation - in a real app, you would call an AI API
                return new Promise(resolve => {
                    setTimeout(() => {
                        const analyzedData = JSON.parse(JSON.stringify(data));
                        const issues = {};
                        
                        // Analyze first 1000 rows for performance
                        const sampleRows = analyzedData.data.slice(0, 1000);
                        
                        sampleRows.forEach((row, rowIndex) => {
                            issues[row._rowNumber] = {};
                            
                            data.headers.forEach(header => {
                                const value = row[header] || '';
                                const cellIssues = [];
                                
                                // Check for empty values
                                if (!value || value.trim() === '') {
                                    cellIssues.push({
                                        type: 'empty',
                                        message: '‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á',
                                        suggestion: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
                                    });
                                }
                                
                                // Check for duplicates (simplified)
                                if (value && this.checkForDuplicates(header, value, sampleRows)) {
                                    cellIssues.push({
                                        type: 'duplicate',
                                        message: '‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥',
                                        suggestion: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
                                    });
                                }
                                
                                // Check format based on header name
                                if (value && this.checkFormat(header, value)) {
                                    cellIssues.push({
                                        type: 'format',
                                        message: '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                                        suggestion: this.getFormatSuggestion(header)
                                    });
                                }
                                
                                if (cellIssues.length > 0) {
                                    issues[row._rowNumber][header] = cellIssues[0];
                                }
                            });
                        });
                        
                        // Calculate statistics
                        const totalCells = sampleRows.length * data.headers.length;
                        let emptyCount = 0, duplicateCount = 0, formatCount = 0;
                        
                        Object.values(issues).forEach(rowIssues => {
                            Object.values(rowIssues).forEach(issue => {
                                switch(issue.type) {
                                    case 'empty': emptyCount++; break;
                                    case 'duplicate': duplicateCount++; break;
                                    case 'format': formatCount++; break;
                                }
                            });
                        });
                        
                        const stats = {
                            emptyPercent: Math.round((emptyCount / totalCells) * 100),
                            duplicatePercent: Math.round((duplicateCount / totalCells) * 100),
                            formatPercent: Math.round((formatCount / totalCells) * 100),
                            correctPercent: 100 - Math.round(((emptyCount + duplicateCount + formatCount) / totalCells) * 100)
                        };
                        
                        resolve({
                            data: analyzedData,
                            issues,
                            stats
                        });
                    }, 2000);
                });
            }
            
            checkForDuplicates(column, value, rows) {
                let count = 0;
                rows.forEach(row => {
                    if (row[column] === value) count++;
                });
                return count > 1;
            }
            
            checkFormat(column, value) {
                const lowerColumn = column.toLowerCase();
                
                if (lowerColumn.includes('email')) {
                    return !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                }
                
                if (lowerColumn.includes('phone') || lowerColumn.includes('tel')) {
                    return !/^[0-9+\-\s()]{10,}$/.test(value);
                }
                
                if (lowerColumn.includes('date')) {
                    return isNaN(Date.parse(value));
                }
                
                if (lowerColumn.includes('number') || lowerColumn.includes('amount')) {
                    return isNaN(parseFloat(value));
                }
                
                return false;
            }
            
            getFormatSuggestion(column) {
                const lowerColumn = column.toLowerCase();
                
                if (lowerColumn.includes('email')) {
                    return '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•: example@domain.com';
                }
                
                if (lowerColumn.includes('phone') || lowerColumn.includes('tel')) {
                    return '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: 081-234-5678 ‡∏´‡∏£‡∏∑‡∏≠ 0812345678';
                }
                
                if (lowerColumn.includes('date')) {
                    return '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: YYYY-MM-DD ‡∏´‡∏£‡∏∑‡∏≠ DD/MM/YYYY';
                }
                
                if (lowerColumn.includes('number') || lowerColumn.includes('amount')) {
                    return '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç: 123.45 ‡∏´‡∏£‡∏∑‡∏≠ 1,234.56';
                }
                
                return '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            }
            
            generateAutoFixSuggestions() {
                this.autoFixSuggestions = [];
                
                if (!this.processedData || !this.processedData.issues) return;
                
                Object.entries(this.processedData.issues).forEach(([rowIndex, rowIssues]) => {
                    Object.entries(rowIssues).forEach(([column, issue]) => {
                        const suggestion = {
                            row: parseInt(rowIndex),
                            column,
                            issue: issue.type,
                            message: issue.message,
                            suggestion: issue.suggestion,
                            originalValue: this.uploadedData.data[rowIndex]?.[column] || '',
                            fixedValue: this.generateFixValue(column, issue.type, this.uploadedData.data[rowIndex]?.[column] || '')
                        };
                        
                        this.autoFixSuggestions.push(suggestion);
                    });
                });
                
                // Update quick fix count
                document.getElementById('quickFixCount').textContent = this.autoFixSuggestions.length;
            }
            
            generateFixValue(column, issueType, originalValue) {
                switch(issueType) {
                    case 'empty':
                        return '[‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•]';
                    case 'duplicate':
                        return originalValue; // Keep original for user to decide
                    case 'format':
                        const lowerColumn = column.toLowerCase();
                        if (lowerColumn.includes('email')) {
                            return originalValue.replace(/\s+/g, '').toLowerCase();
                        }
                        if (lowerColumn.includes('phone')) {
                            return originalValue.replace(/\D/g, '').replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
                        }
                        return originalValue;
                    default:
                        return originalValue;
                }
            }
            
            async autoFix() {
                if (this.autoFixSuggestions.length === 0) {
                    toastr.info('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
                    return;
                }
                
                try {
                    this.showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...', 0);
                    
                    let fixedCount = 0;
                    const total = this.autoFixSuggestions.length;
                    
                    for (let i = 0; i < total; i++) {
                        const suggestion = this.autoFixSuggestions[i];
                        
                        // Apply fix to data
                        if (this.uploadedData.data[suggestion.row]) {
                            this.uploadedData.data[suggestion.row][suggestion.column] = suggestion.fixedValue;
                            fixedCount++;
                        }
                        
                        // Update progress
                        const progress = Math.round(((i + 1) / total) * 100);
                        this.updateLoadingProgress(progress, `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ${i + 1}/${total}...`);
                        
                        await new Promise(resolve => setTimeout(resolve, 50));
                    }
                    
                    // Update display
                    this.displayDataPage(this.currentPage);
                    
                    // Update stats
                    this.stats.totalErrorsFixed += fixedCount;
                    this.updateStats();
                    
                    toastr.success(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ${fixedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
                    
                } catch (error) {
                    console.error('Error in auto fix:', error);
                    toastr.error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
                } finally {
                    this.hideLoading();
                }
            }
            
            async validateData() {
                if (!this.uploadedData) return;
                
                try {
                    this.showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 0);
                    
                    // Run validation rules
                    const validationResults = await this.runValidationRules();
                    
                    // Display results
                    this.showValidationResults(validationResults);
                    
                    toastr.success('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
                    
                } catch (error) {
                    console.error('Error validating data:', error);
                    toastr.error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
                } finally {
                    this.hideLoading();
                }
            }
            
            async runValidationRules() {
                // This would run custom validation rules
                return new Promise(resolve => {
                    setTimeout(() => {
                        const results = {
                            passed: 0,
                            failed: 0,
                            warnings: 0,
                            details: []
                        };
                        
                        // Simulate validation
                        for (let i = 0; i < 10; i++) {
                            const passed = Math.random() > 0.3;
                            if (passed) {
                                results.passed++;
                            } else {
                                results.failed++;
                            }
                            
                            results.details.push({
                                rule: `Rule ${i + 1}`,
                                status: passed ? 'passed' : 'failed',
                                message: passed ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'
                            });
                        }
                        
                        resolve(results);
                    }, 1000);
                });
            }
            
            showValidationResults(results) {
                const panel = document.getElementById('autoFixPanel');
                panel.style.display = 'block';
                
                const resultsDiv = document.getElementById('autoFixResults');
                resultsDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
                        <div style="text-align: center; padding: 20px; background: #d4edda; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #155724;">${results.passed}</div>
                            <div style="color: #155724;">‡∏ú‡πà‡∏≤‡∏ô</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8d7da; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #721c24;">${results.failed}</div>
                            <div style="color: #721c24;">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #fff3cd; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #856404;">${results.warnings}</div>
                            <div style="color: #856404;">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                        </div>
                    </div>
                    <h5>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</h5>
                    <ul style="list-style: none; padding: 0;">
                        ${results.details.map(detail => `
                            <li style="padding: 10px; margin: 5px 0; background: ${detail.status === 'passed' ? '#d4edda' : '#f8d7da'}; border-radius: 4px;">
                                <strong>${detail.rule}:</strong> ${detail.message}
                            </li>
                        `).join('')}
                    </ul>
                `;
            }
            
            updateDashboard() {
                if (!this.processedData || !this.processedData.stats) return;
                
                const stats = this.processedData.stats;
                
                // Update bars with animation
                setTimeout(() => {
                    document.getElementById('duplicateBar').style.width = `${stats.duplicatePercent}%`;
                    document.getElementById('duplicateBar').textContent = `${stats.duplicatePercent}%`;
                    document.getElementById('duplicateValue').textContent = `${stats.duplicatePercent}%`;
                    
                    document.getElementById('emptyBar').style.width = `${stats.emptyPercent}%`;
                    document.getElementById('emptyBar').textContent = `${stats.emptyPercent}%`;
                    document.getElementById('emptyValue').textContent = `${stats.emptyPercent}%`;
                    
                    document.getElementById('formatBar').style.width = `${stats.formatPercent}%`;
                    document.getElementById('formatBar').textContent = `${stats.formatPercent}%`;
                    document.getElementById('formatValue').textContent = `${stats.formatPercent}%`;
                    
                    // Update pie chart
                    const correct = stats.correctPercent;
                    const error = 100 - correct;
                    document.getElementById('statusCircle').style.background = 
                        `conic-gradient(#4caf50 ${correct}%, #ff9800 0%)`;
                    document.getElementById('correctPercent').textContent = `${correct}%`;
                    document.getElementById('correctCount').textContent = `${correct}% ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`;
                    document.getElementById('errorCount').textContent = `${error}% ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç`;
                }, 100);
                
                // Show dashboard
                document.getElementById('dashboardSection').classList.add('show');
            }
            
            startCellEdit(cell) {
                if (!this.isEditMode) return;
                
                const originalValue = cell.dataset.originalValue || '';
                const rowIndex = parseInt(cell.dataset.row);
                const column = cell.dataset.column;
                
                // Save state for undo
                this.saveEditState({
                    type: 'edit',
                    row: rowIndex,
                    column,
                    oldValue: originalValue,
                    newValue: originalValue, // Will be updated on save
                    timestamp: new Date()
                });
                
                // Create input
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'cell-input';
                input.value = originalValue;
                
                // Replace cell content with input
                cell.textContent = '';
                cell.appendChild(input);
                cell.classList.add('editing');
                
                // Focus and select
                input.focus();
                input.select();
                
                // Handle input events
                const handleInput = (e) => {
                    if (e.key === 'Enter') {
                        this.finishCellEdit(cell, input.value);
                    } else if (e.key === 'Escape') {
                        this.cancelCellEdit(cell, originalValue);
                    }
                };
                
                input.addEventListener('keydown', handleInput);
                input.addEventListener('blur', () => {
                    setTimeout(() => {
                        if (cell.classList.contains('editing')) {
                            this.finishCellEdit(cell, input.value);
                        }
                    }, 100);
                });
                
                cell._currentInput = input;
            }
            
            finishCellEdit(cell, newValue) {
                const rowIndex = parseInt(cell.dataset.row);
                const column = cell.dataset.column;
                const originalValue = cell.dataset.originalValue || '';
                
                // Update cell
                cell.textContent = newValue;
                cell.title = newValue;
                cell.classList.remove('editing');
                cell.dataset.originalValue = newValue;
                
                // Update data
                if (this.uploadedData.data[rowIndex]) {
                    this.uploadedData.data[rowIndex][column] = newValue;
                }
                
                // Remove input reference
                delete cell._currentInput;
                
                // Update edit history
                if (this.editHistory[this.currentHistoryIndex]) {
                    this.editHistory[this.currentHistoryIndex].newValue = newValue;
                }
                
                // Show message
                this.showEditMessage(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ñ‡∏ß ${rowIndex + 1}, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "${column}"`, 'success');
                
                // Update undo/redo buttons
                this.updateUndoRedoButtons();
            }
            
            cancelCellEdit(cell, originalValue) {
                cell.textContent = originalValue;
                cell.title = originalValue;
                cell.classList.remove('editing');
                
                // Remove from history if not saved
                if (this.editHistory[this.currentHistoryIndex]) {
                    this.editHistory.splice(this.currentHistoryIndex, 1);
                    this.currentHistoryIndex--;
                }
                
                delete cell._currentInput;
                this.updateUndoRedoButtons();
            }
            
            toggleEditMode() {
                this.isEditMode = !this.isEditMode;
                const btn = document.getElementById('toggleEditMode');
                const editControls = document.getElementById('editControls');
                
                if (this.isEditMode) {
                    btn.innerHTML = '<i class="fas fa-times"></i> ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                    editControls.classList.add('show');
                    this.showEditMessage('‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'info');
                    
                    // Add event listeners to all cells
                    document.querySelectorAll('.editable-cell').forEach(cell => {
                        cell.addEventListener('dblclick', (e) => this.startCellEdit(e.target));
                    });
                } else {
                    btn.innerHTML = '<i class="fas fa-edit"></i> ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                    editControls.classList.remove('show');
                    this.showEditMessage('‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'info');
                    
                    // Cancel any ongoing edits
                    document.querySelectorAll('.editing').forEach(cell => {
                        this.cancelCellEdit(cell, cell.dataset.originalValue);
                    });
                }
            }
            
            saveAllEdits() {
                // In this implementation, edits are saved immediately
                this.showEditMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
            
            cancelAllEdits() {
                // Reload original data
                if (this.uploadedData) {
                    this.displayDataPage(this.currentPage);
                    this.editHistory = [];
                    this.currentHistoryIndex = -1;
                    this.updateUndoRedoButtons();
                    this.showEditMessage('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'warning');
                }
            }
            
            saveEditState(edit) {
                // Remove redo history if we're not at the end
                this.editHistory = this.editHistory.slice(0, this.currentHistoryIndex + 1);
                this.editHistory.push(edit);
                this.currentHistoryIndex++;
                this.updateUndoRedoButtons();
            }
            
            undo() {
                if (this.currentHistoryIndex < 0) return;
                
                const edit = this.editHistory[this.currentHistoryIndex];
                
                // Revert the edit
                if (this.uploadedData.data[edit.row]) {
                    this.uploadedData.data[edit.row][edit.column] = edit.oldValue;
                }
                
                // Update display
                const cell = document.querySelector(`[data-row="${edit.row}"][data-column="${edit.column}"]`);
                if (cell) {
                    cell.textContent = edit.oldValue;
                    cell.title = edit.oldValue;
                    cell.dataset.originalValue = edit.oldValue;
                }
                
                this.currentHistoryIndex--;
                this.updateUndoRedoButtons();
                
                this.showEditMessage(`‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ñ‡∏ß ${edit.row + 1}, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "${edit.column}"`, 'info');
            }
            
            redo() {
                if (this.currentHistoryIndex >= this.editHistory.length - 1) return;
                
                this.currentHistoryIndex++;
                const edit = this.editHistory[this.currentHistoryIndex];
                
                // Apply the edit
                if (this.uploadedData.data[edit.row]) {
                    this.uploadedData.data[edit.row][edit.column] = edit.newValue;
                }
                
                // Update display
                const cell = document.querySelector(`[data-row="${edit.row}"][data-column="${edit.column}"]`);
                if (cell) {
                    cell.textContent = edit.newValue;
                    cell.title = edit.newValue;
                    cell.dataset.originalValue = edit.newValue;
                }
                
                this.updateUndoRedoButtons();
                
                this.showEditMessage(`‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ñ‡∏ß ${edit.row + 1}, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "${edit.column}"`, 'info');
            }
            
            updateUndoRedoButtons() {
                document.getElementById('undoBtn').disabled = this.currentHistoryIndex < 0;
                document.getElementById('redoBtn').disabled = this.currentHistoryIndex >= this.editHistory.length - 1;
            }
            
            showEditMessage(message, type = 'info') {
                const messageDiv = document.getElementById('editMessage');
                messageDiv.textContent = message;
                messageDiv.className = 'edit-message show';
                
                switch(type) {
                    case 'success':
                        messageDiv.classList.add('success');
                        break;
                    case 'error':
                        messageDiv.classList.add('error');
                        break;
                    case 'warning':
                        messageDiv.classList.add('warning');
                        break;
                    default:
                        messageDiv.classList.add('info');
                }
                
                // Auto hide after 3 seconds
                setTimeout(() => {
                    messageDiv.classList.remove('show');
                }, 3000);
            }
            
            async exportData() {
                if (!this.uploadedData) return;
                
                const selectedFormat = document.querySelector('.format-option.selected')?.dataset.format;
                if (!selectedFormat) {
                    toastr.warning('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                    return;
                }
                
                try {
                    this.showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 0);
                    
                    let content, filename, mimeType;
                    
                    switch(selectedFormat) {
                        case 'csv':
                            content = this.exportToCSV();
                            filename = 'cleaned_data.csv';
                            mimeType = 'text/csv';
                            break;
                        case 'excel':
                            content = await this.exportToExcel();
                            filename = 'cleaned_data.xlsx';
                            mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';
                            break;
                        case 'json':
                            content = this.exportToJSON();
                            filename = 'cleaned_data.json';
                            mimeType = 'application/json';
                            break;
                        case 'pdf':
                            await this.exportToPDF();
                            document.getElementById('exportOptions').classList.remove('show');
                            this.hideLoading();
                            return;
                        case 'sql':
                            content = this.exportToSQL();
                            filename = 'cleaned_data.sql';
                            mimeType = 'application/sql';
                            break;
                    }
                    
                    // Download file
                    this.downloadFile(content, filename, mimeType);
                    
                    toastr.success('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    
                } catch (error) {
                    console.error('Error exporting data:', error);
                    toastr.error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
                } finally {
                    this.hideLoading();
                    document.getElementById('exportOptions').classList.remove('show');
                }
            }
            
            exportToCSV() {
                const headers = this.displayedColumns;
                let csv = headers.join(',') + '\n';
                
                this.uploadedData.data.forEach(row => {
                    const values = headers.map(header => {
                        let value = row[header] || '';
                        // Escape commas and quotes
                        if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                            value = '"' + value.replace(/"/g, '""') + '"';
                        }
                        return value;
                    });
                    csv += values.join(',') + '\n';
                });
                
                return csv;
            }
            
            async exportToExcel() {
                const headers = this.displayedColumns;
                const data = this.uploadedData.data.map(row => 
                    headers.map(header => row[header] || '')
                );
                
                const worksheet = XLSX.utils.aoa_to_sheet([headers, ...data]);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Cleaned Data");
                
                return XLSX.write(workbook, { type: 'array', bookType: 'xlsx' });
            }
            
            exportToJSON() {
                const data = this.uploadedData.data.map(row => {
                    const obj = {};
                    this.displayedColumns.forEach(header => {
                        obj[header] = row[header] || '';
                    });
                    return obj;
                });
                
                return JSON.stringify(data, null, 2);
            }
            
            async exportToPDF() {
                // This would use a PDF library like jsPDF
                toastr.info('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤');
            }
            
            exportToSQL() {
                const tableName = 'cleaned_data';
                let sql = `CREATE TABLE ${tableName} (\n`;
                sql += this.displayedColumns.map(col => `  ${col} VARCHAR(255)`).join(',\n');
                sql += '\n);\n\n';
                
                this.uploadedData.data.forEach(row => {
                    const values = this.displayedColumns.map(col => {
                        const value = row[col] || '';
                        return `'${value.replace(/'/g, "''")}'`;
                    });
                    sql += `INSERT INTO ${tableName} VALUES (${values.join(', ')});\n`;
                });
                
                return sql;
            }
            
            downloadFile(content, filename, mimeType) {
                let blob;
                
                if (content instanceof ArrayBuffer) {
                    blob = new Blob([content], { type: mimeType });
                } else {
                    blob = new Blob([content], { type: mimeType + ';charset=utf-8;' });
                }
                
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
            
            searchData(query) {
                if (!query.trim() || !this.uploadedData) {
                    this.displayDataPage(1);
                    return;
                }
                
                const results = this.uploadedData.data.filter(row => {
                    return this.displayedColumns.some(column => {
                        const value = row[column] || '';
                        return value.toString().toLowerCase().includes(query.toLowerCase());
                    });
                }).slice(0, this.rowsPerPage);
                
                this.renderTable(results);
                
                // Update count
                document.getElementById('rowCount').textContent = 
                    `‡∏û‡∏ö ${results.length} ‡πÅ‡∏ñ‡∏ß (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${this.uploadedData.totalRows} ‡πÅ‡∏ñ‡∏ß)`;
            }
            
            showContextMenu(e, cell = null) {
                e.preventDefault();
                
                const menu = document.getElementById('contextMenu');
                menu.style.display = 'block';
                menu.style.left = e.pageX + 'px';
                menu.style.top = e.pageY + 'px';
                
                // Store context
                menu.dataset.cell = cell ? JSON.stringify({
                    row: cell.dataset.row,
                    column: cell.dataset.column,
                    value: cell.dataset.originalValue
                }) : '{}';
                
                // Add event listeners to menu items
                menu.querySelectorAll('.context-menu-item').forEach(item => {
                    item.onclick = (e) => this.handleContextAction(e.target.dataset.action, cell);
                });
            }
            
            hideContextMenu() {
                document.getElementById('contextMenu').style.display = 'none';
            }
            
            handleContextAction(action, cell) {
                this.hideContextMenu();
                
                switch(action) {
                    case 'edit':
                        if (cell) this.startCellEdit(cell);
                        break;
                    case 'copy':
                        if (cell) this.copyCellValue(cell);
                        break;
                    case 'delete':
                        if (cell) this.deleteCellValue(cell);
                        break;
                    case 'fill-down':
                        this.fillDown(cell);
                        break;
                    case 'fill-up':
                        this.fillUp(cell);
                        break;
                    case 'delete-row':
                        this.deleteRow(cell);
                        break;
                    case 'insert-row':
                        this.insertRow(cell);
                        break;
                    case 'add-comment':
                        this.addComment(cell);
                        break;
                }
            }
            
            copyCellValue(cell) {
                const text = cell.dataset.originalValue || '';
                navigator.clipboard.writeText(text).then(() => {
                    toastr.success('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß');
                });
            }
            
            deleteCellValue(cell) {
                const row = parseInt(cell.dataset.row);
                const column = cell.dataset.column;
                
                this.saveEditState({
                    type: 'delete',
                    row,
                    column,
                    oldValue: cell.dataset.originalValue,
                    newValue: '',
                    timestamp: new Date()
                });
                
                cell.textContent = '';
                cell.title = '';
                cell.dataset.originalValue = '';
                
                if (this.uploadedData.data[row]) {
                    this.uploadedData.data[row][column] = '';
                }
                
                this.showEditMessage('‡∏•‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'warning');
            }
            
            fillDown(cell) {
                if (!cell) return;
                
                const row = parseInt(cell.dataset.row);
                const column = cell.dataset.column;
                const value = cell.dataset.originalValue || '';
                
                // Fill down for next 10 rows
                for (let i = row + 1; i <= Math.min(row + 10, this.uploadedData.data.length - 1); i++) {
                    const targetCell = document.querySelector(`[data-row="${i}"][data-column="${column}"]`);
                    if (targetCell && (!targetCell.dataset.originalValue || targetCell.dataset.originalValue.trim() === '')) {
                        this.saveEditState({
                            type: 'fill-down',
                            row: i,
                            column,
                            oldValue: targetCell.dataset.originalValue,
                            newValue: value,
                            timestamp: new Date()
                        });
                        
                        targetCell.textContent = value;
                        targetCell.title = value;
                        targetCell.dataset.originalValue = value;
                        
                        if (this.uploadedData.data[i]) {
                            this.uploadedData.data[i][column] = value;
                        }
                    }
                }
                
                toastr.success('‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
            
            fillUp(cell) {
                if (!cell) return;
                
                const row = parseInt(cell.dataset.row);
                const column = cell.dataset.column;
                const value = cell.dataset.originalValue || '';
                
                // Fill up for previous 10 rows
                for (let i = row - 1; i >= Math.max(0, row - 10); i--) {
                    const targetCell = document.querySelector(`[data-row="${i}"][data-column="${column}"]`);
                    if (targetCell && (!targetCell.dataset.originalValue || targetCell.dataset.originalValue.trim() === '')) {
                        this.saveEditState({
                            type: 'fill-up',
                            row: i,
                            column,
                            oldValue: targetCell.dataset.originalValue,
                            newValue: value,
                            timestamp: new Date()
                        });
                        
                        targetCell.textContent = value;
                        targetCell.title = value;
                        targetCell.dataset.originalValue = value;
                        
                        if (this.uploadedData.data[i]) {
                            this.uploadedData.data[i][column] = value;
                        }
                    }
                }
                
                toastr.success('‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
            
            deleteRow(cell) {
                if (!cell) return;
                
                const row = parseInt(cell.dataset.row);
                
                if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß ${row + 1} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                    this.saveEditState({
                        type: 'delete-row',
                        row,
                        data: this.uploadedData.data[row],
                        timestamp: new Date()
                    });
                    
                    // Remove from data
                    this.uploadedData.data.splice(row, 1);
                    this.uploadedData.totalRows--;
                    
                    // Update row numbers
                    this.uploadedData.data.forEach((r, i) => {
                        r._rowNumber = i;
                    });
                    
                    // Update display
                    this.displayDataPage(this.currentPage);
                    
                    toastr.success('‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                }
            }
            
            insertRow(cell) {
                const row = cell ? parseInt(cell.dataset.row) : 0;
                
                this.saveEditState({
                    type: 'insert-row',
                    row,
                    timestamp: new Date()
                });
                
                // Create new row
                const newRow = {};
                this.uploadedData.headers.forEach(header => {
                    newRow[header] = '';
                });
                newRow._rowNumber = row;
                
                // Insert at position
                this.uploadedData.data.splice(row, 0, newRow);
                this.uploadedData.totalRows++;
                
                // Update row numbers
                this.uploadedData.data.forEach((r, i) => {
                    r._rowNumber = i;
                });
                
                // Update display
                this.displayDataPage(this.currentPage);
                
                toastr.success('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
            
            addComment(cell) {
                if (!cell) return;
                
                const comment = prompt('‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:');
                if (comment) {
                    const key = `${cell.dataset.row}_${cell.dataset.column}`;
                    this.comments.set(key, {
                        text: comment,
                        author: '‡∏Ñ‡∏∏‡∏ì',
                        timestamp: new Date()
                    });
                    
                    // Add comment indicator
                    if (!cell.querySelector('.cell-comment')) {
                        const indicator = document.createElement('div');
                        indicator.className = 'cell-comment';
                        indicator.title = comment;
                        cell.style.position = 'relative';
                        cell.appendChild(indicator);
                        
                        // Show comment on hover
                        indicator.addEventListener('mouseenter', (e) => {
                            const bubble = document.getElementById('commentBubble');
                            bubble.querySelector('#commentAuthor').textContent = '‡∏Ñ‡∏∏‡∏ì';
                            bubble.querySelector('#commentText').textContent = comment;
                            bubble.classList.add('show');
                            bubble.style.left = e.pageX + 'px';
                            bubble.style.top = e.pageY + 'px';
                        });
                        
                        indicator.addEventListener('mouseleave', () => {
                            setTimeout(() => {
                                document.getElementById('commentBubble').classList.remove('show');
                            }, 100);
                        });
                    }
                    
                    toastr.success('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏•‡πâ‡∏ß');
                }
            }
            
            applyQuickFixes() {
                if (this.autoFixSuggestions.length === 0) {
                    toastr.info('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏î‡πà‡∏ß‡∏ô');
                    return;
                }
                
                // Apply first 5 quick fixes
                const fixesToApply = this.autoFixSuggestions.slice(0, 5);
                
                fixesToApply.forEach(fix => {
                    if (this.uploadedData.data[fix.row]) {
                        this.uploadedData.data[fix.row][fix.column] = fix.fixedValue;
                    }
                    
                    // Update cell if visible
                    const cell = document.querySelector(`[data-row="${fix.row}"][data-column="${fix.column}"]`);
                    if (cell) {
                        cell.textContent = fix.fixedValue;
                        cell.title = fix.fixedValue;
                        cell.dataset.originalValue = fix.fixedValue;
                    }
                });
                
                // Update remaining fixes
                this.autoFixSuggestions = this.autoFixSuggestions.slice(5);
                document.getElementById('quickFixCount').textContent = this.autoFixSuggestions.length;
                
                if (this.autoFixSuggestions.length === 0) {
                    document.getElementById('floatingQuickFix').style.display = 'none';
                }
                
                toastr.success(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏î‡πà‡∏ß‡∏ô ${fixesToApply.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
            }
            
            createBackup() {
                if (!this.uploadedData) {
                    toastr.warning('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏≥‡∏£‡∏≠‡∏á');
                    return;
                }
                
                const backup = {
                    data: this.uploadedData,
                    timestamp: new Date().toISOString(),
                    version: '3.0.0'
                };
                
                const backupStr = JSON.stringify(backup);
                const filename = `backup_${new Date().toISOString().slice(0, 10)}.json`;
                
                this.downloadFile(backupStr, filename, 'application/json');
                toastr.success('‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
            
            showHelp() {
                const helpContent = `
                    <h3>‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Clean Data</h3>
                    <ol>
                        <li><strong>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå:</strong> ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV, Excel ‡∏´‡∏£‡∏∑‡∏≠ JSON ‡∏°‡∏≤‡∏ß‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</li>
                        <li><strong>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á</li>
                        <li><strong>‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                        <li><strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
                        <li><strong>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ</li>
                    </ol>
                    <p><strong>‡πÅ‡∏õ‡πâ‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏•‡∏±‡∏î:</strong></p>
                    <ul>
                        <li>Ctrl+S: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</li>
                        <li>Ctrl+Z: ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</li>
                        <li>Ctrl+Y: ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥</li>
                        <li>Ctrl+F: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</li>
                        <li>F1: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</li>
                    </ul>
                `;
                
                // In a real app, you would show this in a modal
                alert(helpContent.replace(/<[^>]*>/g, ''));
            }
            
            loadSampleData() {
                const sampleData = {
                    headers: ['‡∏ä‡∏∑‡πà‡∏≠', '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£', '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', '‡πÅ‡∏ú‡∏ô‡∏Å'],
                    data: [
                        { '‡∏ä‡∏∑‡πà‡∏≠': '‡∏™‡∏°‡∏ä‡∏≤‡∏¢', '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': '‡πÉ‡∏à‡∏î‡∏µ', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•': 'somchai@email.com', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': '081-234-5678', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£': '2024-01-01', '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': '35000', '‡πÅ‡∏ú‡∏ô‡∏Å': '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î' },
                        { '‡∏ä‡∏∑‡πà‡∏≠': '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á', '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': '‡∏£‡∏±‡∏Å‡∏á‡∏≤‡∏ô', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•': 'somying@email.com', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': '082-345-6789', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£': '2024-01-02', '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': '42000', '‡πÅ‡∏ú‡∏ô‡∏Å': '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ' },
                        { '‡∏ä‡∏∑‡πà‡∏≠': 'John', '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': 'Doe', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•': 'john.doe@email.com', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': '083-456-7890', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£': '2024-01-03', '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': '50000', '‡πÅ‡∏ú‡∏ô‡∏Å': 'IT' },
                        { '‡∏ä‡∏∑‡πà‡∏≠': 'Jane', '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': 'Smith', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•': 'jane.smith@email.com', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': '084-567-8901', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£': '2024-01-04', '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': '48000', '‡πÅ‡∏ú‡∏ô‡∏Å': 'HR' },
                        { '‡∏ä‡∏∑‡πà‡∏≠': '', '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': '‡∏ó‡∏î‡∏™‡∏≠‡∏ö', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•': 'test@email', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£': '2024/01/05', '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': 'abc', '‡πÅ‡∏ú‡∏ô‡∏Å': '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î' },
                        { '‡∏ä‡∏∑‡πà‡∏≠': '‡∏™‡∏°‡∏ä‡∏≤‡∏¢', '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': '‡πÉ‡∏à‡∏î‡∏µ', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•': 'somchai@email.com', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': '081-234-5678', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£': '2024-01-01', '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': '35000', '‡πÅ‡∏ú‡∏ô‡∏Å': '‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î' },
                    ]
                };
                
                this.uploadedData = {
                    headers: sampleData.headers,
                    data: sampleData.data.map((row, i) => ({
                        ...row,
                        _rowNumber: i
                    })),
                    totalRows: sampleData.data.length,
                    fileType: 'CSV'
                };
                
                // Update UI
                this.createColumnSelector(this.uploadedData.headers);
                this.displayDataPage(1);
                document.getElementById('processBtn').disabled = false;
                document.getElementById('autoFixBtn').disabled = false;
                document.getElementById('validateBtn').disabled = false;
                document.getElementById('fileInfo').classList.add('show');
                document.getElementById('dataPreview').classList.add('show');
                
                toastr.success('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
            
            sortColumn(column) {
                if (!this.uploadedData) return;
                
                const direction = this.uploadedData.sortDirection === 'asc' ? 'desc' : 'asc';
                this.uploadedData.sortDirection = direction;
                
                this.uploadedData.data.sort((a, b) => {
                    const valA = a[column] || '';
                    const valB = b[column] || '';
                    
                    if (direction === 'asc') {
                        return valA.localeCompare(valB);
                    } else {
                        return valB.localeCompare(valA);
                    }
                });
                
                this.displayDataPage(this.currentPage);
                
                // Add sort indicator
                document.querySelectorAll('th').forEach(th => th.innerHTML = th.innerHTML.replace(/ ‚Üë| ‚Üì/g, ''));
                const header = Array.from(document.querySelectorAll('th')).find(th => th.textContent.includes(column));
                if (header) {
                    header.innerHTML += direction === 'asc' ? ' ‚Üë' : ' ‚Üì';
                }
                
                toastr.success(`‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "${column}" ${direction === 'asc' ? '‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å' : '‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢'}`);
            }
            
            updateSelectedCount() {
                const count = this.selectedCells.size;
                const countElement = document.getElementById('selectedCount');
                
                if (count > 0) {
                    countElement.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${count}`;
                    countElement.style.display = 'inline';
                } else {
                    countElement.style.display = 'none';
                }
            }
            
            async saveToIndexedDB(data) {
                // This would save to IndexedDB for offline use
                console.log('Saving to IndexedDB:', data);
            }
            
            setupServiceWorker() {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js').catch(console.error);
                }
            }
            
            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl+S to save
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        this.saveAllEdits();
                    }
                    
                    // Ctrl+Z to undo
                    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                        e.preventDefault();
                        this.undo();
                    }
                    
                    // Ctrl+Y or Ctrl+Shift+Z to redo
                    if (((e.ctrlKey || e.metaKey) && e.key === 'y') || 
                        ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'z')) {
                        e.preventDefault();
                        this.redo();
                    }
                    
                    // Ctrl+F to focus search
                    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                    }
                    
                    // F1 for help
                    if (e.key === 'F1') {
                        e.preventDefault();
                        this.showHelp();
                    }
                    
                    // Escape to cancel
                    if (e.key === 'Escape') {
                        this.hideContextMenu();
                        document.getElementById('exportOptions').classList.remove('show');
                        document.getElementById('columnSelector').classList.remove('show');
                    }
                });
            }
            
            showAnalysisResults() {
                if (!this.processedData) return;
                
                const stats = this.processedData.stats;
                const totalIssues = stats.emptyPercent + stats.duplicatePercent + stats.formatPercent;
                
                const results = `
                    <h4>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</h4>
                    <ul>
                        <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${stats.correctPercent}%</li>
                        <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á: ${stats.emptyPercent}%</li>
                        <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥: ${stats.duplicatePercent}%</li>
                        <li>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏¥‡∏î: ${stats.formatPercent}%</li>
                    </ul>
                    <p>‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${this.autoFixSuggestions.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                `;
                
                // In a real app, you would show this in a modal
                console.log(results);
            }
            
            updateStep(stepNumber, status) {
                return new Promise(resolve => {
                    const stepCard = document.getElementById(`step-${stepNumber}`);
                    const stepStatus = stepCard.querySelector('.step-status');
                    
                    stepCard.classList.remove('active', 'completed');
                    stepStatus.textContent = status;
                    
                    stepCard.classList.add('active');
                    
                    setTimeout(() => {
                        stepCard.classList.remove('active');
                        stepCard.classList.add('completed');
                        stepStatus.textContent = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                        resolve();
                    }, 1000);
                });
            }
            
            async simulateProgress(targetPercent) {
                return new Promise(resolve => {
                    const interval = setInterval(() => {
                        const current = parseInt(document.getElementById('loadingProgress').style.width) || 0;
                        if (current >= targetPercent) {
                            clearInterval(interval);
                            resolve();
                        } else {
                            document.getElementById('loadingProgress').style.width = (current + 1) + '%';
                        }
                    }, 20);
                });
            }
            
            showLoading(title = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...', initialProgress = 0) {
                document.getElementById('loadingTitle').textContent = title;
                document.getElementById('loadingProgress').style.width = initialProgress + '%';
                document.getElementById('loadingOverlay').classList.add('show');
            }
            
            updateLoadingProgress(progress, message = '') {
                document.getElementById('loadingProgress').style.width = progress + '%';
                if (message) {
                    document.getElementById('loadingMessage').textContent = message;
                }
            }
            
            hideLoading() {
                document.getElementById('loadingOverlay').classList.remove('show');
            }
            
            loadStats() {
                const savedStats = localStorage.getItem('dataCleaningStats');
                if (savedStats) {
                    this.stats = JSON.parse(savedStats);
                }
                this.updateStats();
            }
            
            updateStats() {
                // Update display
                document.getElementById('totalFiles').textContent = this.stats.totalFiles;
                document.getElementById('totalRowsProcessed').textContent = this.stats.totalRowsProcessed.toLocaleString();
                document.getElementById('totalErrorsFixed').textContent = this.stats.totalErrorsFixed.toLocaleString();
                document.getElementById('timeSaved').textContent = Math.round(this.stats.totalErrorsFixed * 0.5 / 60); // Assume 0.5 min per fix
                
                // Save to localStorage
                localStorage.setItem('dataCleaningStats', JSON.stringify(this.stats));
            }
            
            resetAll() {
                if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                    // Reset all state
                    this.uploadedData = null;
                    this.processedData = null;
                    this.allDataRows = [];
                    this.displayedColumns = [];
                    this.displayedRows = [];
                    this.currentPage = 1;
                    this.editHistory = [];
                    this.currentHistoryIndex = -1;
                    this.editedCells.clear();
                    this.selectedCells.clear();
                    this.comments.clear();
                    this.validationRules = [];
                    this.autoFixSuggestions = [];
                    
                    // Reset UI
                    document.getElementById('fileInfo').classList.remove('show');
                    document.getElementById('dataPreview').classList.remove('show');
                    document.getElementById('dashboardSection').classList.remove('show');
                    document.getElementById('exportOptions').classList.remove('show');
                    document.getElementById('columnSelector').classList.remove('show');
                    document.getElementById('editControls').classList.remove('show');
                    document.getElementById('autoFixPanel').style.display = 'none';
                    document.getElementById('floatingQuickFix').style.display = 'none';
                    
                    document.getElementById('processBtn').disabled = true;
                    document.getElementById('autoFixBtn').disabled = true;
                    document.getElementById('validateBtn').disabled = true;
                    document.getElementById('downloadBtn').disabled = true;
                    
                    // Reset steps
                    document.querySelectorAll('.step-card').forEach(card => {
                        card.classList.remove('active', 'completed');
                        card.querySelector('.step-status').textContent = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                    });
                    
                    // Open first step
                    document.getElementById('step-1').classList.add('active');
                    
                    // Clear file input
                    document.getElementById('csvFileInput').value = '';
                    
                    toastr.info('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß');
                }
            }
            
            updateUI() {
                // Update app version and status
                document.getElementById('appVersion').textContent = '‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô 3.0.0';
                document.getElementById('lastUpdate').textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + new Date().toLocaleDateString('th-TH');
                document.getElementById('dataStatus').textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            }
        }
        
        // Initialize the system when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.dataCleaningSystem = new DataCleaningSystem();
            
            // Add event listeners for export format selection
            document.querySelectorAll('.format-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.format-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                });
            });
            
            // Initialize tooltips
            document.querySelectorAll('.tooltip').forEach(element => {
                element.setAttribute('title', element.getAttribute('title') || '');
            });
        });
    </script>
</body>
</html>
